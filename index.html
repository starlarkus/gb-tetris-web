<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="GB Tetris - Play Tetris online with your Game Boy!" />
  <link rel="apple-touch-icon" href="images/logo192.png" />
  <meta name="theme-color" content="#563d7c">
  <title>GB Tetris</title>

  <!-- Bootstrap 4 CSS (local) -->
  <link rel="stylesheet" href="css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/index.css">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }

    /* Hide all screens by default */
    .screen {
      display: none;
    }
  </style>
</head>

<body class="text-center">
  <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="masthead mb-auto">
      <div class="inner"></div>
    </header>

    <main role="main" class="inner cover">
      <div id="root">

        <!-- Screen: Connect (Initial) -->
        <div id="screen-connect" class="screen connect">
          <img src="images/animation.gif" class="gameboy" alt="Game Boy" />
          <h2 class="cover-heading">Tetrilink</h2>
          <p class="lead">Connect your Game Boy, boot Tetris, and start playing with your friends!</p>
          <hr />
          <h4>Connect your Game Boy</h4>
          <p>Connect your Game Boy with the USB to Game Link adapter and click "connect".</p>
          <button id="btn-connect" class="btn btn-lg btn-secondary">Connect</button>
          <br />
          <small>Version: 1.1.14</small>
        </div>

        <!-- Screen: Connecting -->
        <div id="screen-connecting" class="screen connect">
          <h2>Connecting...</h2>
        </div>

        <!-- Screen: Connecting to Tetris -->
        <div id="screen-connecting-tetris" class="screen connect">
          <h2>Connecting to Tetris...</h2>
          <p>Ensure your Game Boy is turned on and in the Tetris main menu.</p>
        </div>

        <!-- Screen: Select Music -->
        <div id="screen-music" class="screen connect">
          <h2>Connection established!</h2>
          <h4>Choose your tunes:</h4>
          <button id="btn-music-a" class="musicButton btn btn-lg btn-secondary">MUSIC A</button>
          <button id="btn-music-b" class="musicButton btn btn-lg btn-secondary">MUSIC B</button><br />
          <hr />
          <button id="btn-music-c" class="musicButton btn btn-lg btn-secondary">MUSIC C</button>
          <button id="btn-music-off" class="musicButton btn btn-lg btn-secondary">MUSIC OFF</button><br />
          <p>(Though obviously A is the best...)</p>
          <br />
          <button id="btn-music-next" class="btn btn-lg btn-secondary">Next</button>
        </div>

        <!-- Screen: Mode Selection (Find Match / Private Lobby) -->
        <div id="screen-mode-select" class="screen connect">
          <h2>Select a username:</h2>
          <input type="text" id="username" class="form-control username-input" />
          <hr />
          <h2>Select Game Mode</h2>
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-6 col-sm-5 mb-3">
                <button id="btn-find-match" class="btn btn-lg btn-secondary btn-block">Find Match</button>
                <p><small>Play a random opponent</small></p>
              </div>
              <div class="col-6 col-sm-5 mb-3">
                <button id="btn-private-lobby" class="btn btn-lg btn-secondary btn-block">Private Lobby</button>
                <p><small>Create or join a private game</small></p>
              </div>
            </div>
          </div>
          <hr />
          <button id="btn-reinit-gameboy" class="btn btn-sm btn-secondary">Reconnect Game Boy</button>
          <p><small>Use this if you restarted your Game Boy</small></p>
        </div>

        <!-- Screen: Matchmaking (Finding Opponent) -->
        <div id="screen-matchmaking" class="screen connect">
          <h2>Finding Opponent...</h2>
          <p>Please wait while we find you a match!</p>
          <div class="spinner-border text-light" role="status">
            <span class="sr-only">Loading...</span>
          </div>
          <hr />
          <button id="btn-cancel-matchmaking" class="btn btn-lg btn-secondary">Cancel</button>
        </div>

        <!-- Screen: Opponent Disconnected -->
        <div id="screen-opponent-disconnect" class="screen connect">
          <h2>Opponent Disconnected</h2>
          <p>Your opponent has left the game. You win!</p>
          <hr />
          <p><strong>Please restart Tetris on your Game Boy before continuing.</strong></p>
          <h4>Find another match?</h4>
          <button id="btn-rematch" class="btn btn-lg btn-secondary">Find Match</button>
          <button id="btn-back-to-menu" class="btn btn-lg btn-secondary">Back to Menu</button>
        </div>

        <!-- Screen: Select Game (Create/Join) -->
        <div id="screen-select-game" class="screen connect">
          <div class="container">
            <div class="row">
              <div class="col-6">
                <div class="card custom-card">
                  <div class="card-body">
                    <div class="card-title">
                      <h4>Create game</h4>
                    </div>
                    <div class="card-text">
                      <button id="btn-create-game" class="btn btn-lg btn-secondary">Create</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="card custom-card">
                  <div class="card-body">
                    <div class="card-title">
                      <h4>Join game</h4>
                    </div>
                    <div class="card-text">
                      <input type="text" id="game-code-input" class="form-control game-code-input" placeholder="1234" />
                      <button id="btn-join-game" class="btn btn-lg btn-secondary">Join</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <p id="join-error" style="display:none; color:#ff6b6b; margin-top:10px; font-weight:bold;"></p>
          <hr />
          <button id="btn-back-to-mode-select" class="btn btn-sm btn-secondary">Back to Menu</button>
        </div>

        <!-- Screen: Joining Game -->
        <div id="screen-joining" class="screen connect">
          <h2>Connecting to game server...</h2>
        </div>

        <!-- Screen: Lobby -->
        <div id="screen-lobby" class="screen connect">
          <h2>In Lobby: <span id="lobby-game-code"></span></h2>
          <h4>Players:</h4>
          <div class="container">
            <div id="lobby-players" class="row justify-content-center"></div>
          </div>
          <div id="lobby-admin-controls">
            <button id="btn-start-game" class="btn btn-lg btn-secondary">Start game!</button>
            <p>&nbsp;</p>
            <h3>Optional: send custom Garbage, Pieces and Well column to the server</h3>
            <p>
              <a href="https://minoselector.gblink.io" target="_blank">&gt; Click here to generate your own RNG &lt;</a>
            </p>
            <textarea id="preset-rng" rows="4"></textarea>
            <div>
              <button id="btn-send-rng" class="btn btn-lg btn-secondary">Send RNG to Server</button>
            </div>
          </div>
          <div id="lobby-waiting">
            <p>Please wait for the lobby leader to start the game!</p>
          </div>
          <hr />
          <button id="btn-leave-lobby-pre" class="btn btn-sm btn-secondary">Leave Lobby</button>
        </div>

        <!-- Screen: Starting Game -->
        <div id="screen-starting" class="screen connect">
          <h2>Starting game...</h2>
        </div>

        <!-- Screen: In Game -->
        <div id="screen-ingame" class="screen connect">
          <h2>In Game: <span id="ingame-game-code"></span></h2>
          <div class="container">
            <div id="ingame-players" class="row justify-content-center"></div>
          </div>
        </div>

        <!-- Screen: Finished -->
        <div id="screen-finished" class="screen connect">
          <h2>In Game: <span id="finished-game-code"></span></h2>
          <div class="container">
            <div id="finished-players" class="row justify-content-center"></div>
          </div>
          <h2>Game finished!</h2>
          <div id="finished-admin-controls">
            <button id="btn-finished-next" class="btn btn-lg btn-secondary">Start next game!</button>
          </div>
          <div id="finished-waiting">
            <p>Waiting for host to start next game...</p>
          </div>
          <div id="finished-matchmaking-controls" style="display:none;">
            <button id="btn-ready-next" class="btn btn-lg btn-secondary">Start Next Round</button>
            <p id="finished-countdown" style="display:none;"></p>
            <p id="finished-ready-status"></p>
          </div>
          <hr />
          <button id="btn-leave-lobby" class="btn btn-sm btn-secondary" style="display:none;">Leave Lobby</button>
        </div>

        <!-- Screen: Error -->
        <div id="screen-error" class="screen connect">
          <h2>Error</h2>
          <h3 id="error-message"></h3>
        </div>

        <!-- Screen: No WebUSB -->
        <div id="screen-no-webusb" class="screen connect">
          <h2>Sorry, your browser does not support WebUSB!</h2>
        </div>

      </div>
    </main>

    <footer class="mastfoot mt-auto">
      <div class="inner">
        <p>Requires <a href="https://github.com/starlarkus/gb-link-firmware-reconfigurable" target="_blank">USB
            Firmware</a> - <a href="https://github.com/starlarkus/gb-tetris-web" target="_blank">Source</a></p>
      </div>
    </footer>
  </div>

  <noscript>You need to enable JavaScript to run this app.</noscript>

  <!-- Scripts -->
  <script src="js/serial.js"></script>
  <script src="js/gbwebsocket.js"></script>
  <script src="js/app.js"></script>
</body>

</html>
